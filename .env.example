# ============================================================
# CHAIN HOST — Environment Configuration
# ============================================================
# Copy this file to .env and fill in your values.
# NEVER commit .env to version control.
# ============================================================

# ─────────────────────────────────────────────────────────────
# GENERAL
# ─────────────────────────────────────────────────────────────
NODE_ENV=production
DOMAIN=your-domain.com
ACME_EMAIL=admin@your-domain.com
TZ=UTC

# ─────────────────────────────────────────────────────────────
# DATABASE — PostgreSQL
# ─────────────────────────────────────────────────────────────
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=chainhost
POSTGRES_USER=chainhost
POSTGRES_PASSWORD=CHANGE_ME_STRONG_PASSWORD_HERE
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}?schema=public

# PgBouncer connection pooling
PGBOUNCER_PORT=6432
PGBOUNCER_MAX_CLIENT_CONN=200
PGBOUNCER_DEFAULT_POOL_SIZE=25

# ─────────────────────────────────────────────────────────────
# REDIS
# ─────────────────────────────────────────────────────────────
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE_ME_REDIS_PASSWORD
REDIS_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}

# ─────────────────────────────────────────────────────────────
# JWT & AUTH
# ─────────────────────────────────────────────────────────────
JWT_SECRET=CHANGE_ME_GENERATE_64_CHAR_SECRET
JWT_EXPIRY=24h
JWT_REFRESH_EXPIRY=7d
BCRYPT_ROUNDS=12

# ─────────────────────────────────────────────────────────────
# MINIO (S3-compatible storage)
# ─────────────────────────────────────────────────────────────
MINIO_ROOT_USER=chainhost-admin
MINIO_ROOT_PASSWORD=CHANGE_ME_MINIO_PASSWORD
MINIO_ENDPOINT=minio
MINIO_PORT=9000
MINIO_CONSOLE_PORT=9001
MINIO_BUCKET_SITES=hosted-sites
MINIO_BUCKET_UPLOADS=user-uploads
MINIO_USE_SSL=false

# ─────────────────────────────────────────────────────────────
# IPFS
# ─────────────────────────────────────────────────────────────
IPFS_API_URL=http://ipfs:5001
IPFS_GATEWAY_URL=http://ipfs:8080

# ─────────────────────────────────────────────────────────────
# BLOCKCHAIN
# ─────────────────────────────────────────────────────────────
BLOCKCHAIN_RPC_URL=http://ganache:8545
BLOCKCHAIN_CHAIN_ID=1337
BLOCKCHAIN_PRIVATE_KEY=CHANGE_ME_DEPLOYER_PRIVATE_KEY
# For production, use Polygon/Base RPC:
# BLOCKCHAIN_RPC_URL=https://polygon-rpc.com
# BLOCKCHAIN_CHAIN_ID=137

# ─────────────────────────────────────────────────────────────
# MAIL SERVER (docker-mailserver)
# ─────────────────────────────────────────────────────────────
MAIL_DOMAIN=your-domain.com
MAIL_HOSTNAME=mail.your-domain.com
MAIL_POSTMASTER=postmaster@your-domain.com
MAIL_RELAY_HOST=
MAIL_RELAY_PORT=587
MAIL_RELAY_USER=
MAIL_RELAY_PASSWORD=
# Enable ClamAV antivirus (uses ~1GB RAM)
ENABLE_CLAMAV=1
# Enable Fail2Ban for mail
ENABLE_FAIL2BAN=1
# Enable SpamAssassin
ENABLE_SPAMASSASSIN=1
# Enable OpenDKIM
ENABLE_OPENDKIM=1
ENABLE_OPENDMARC=1
ENABLE_POLICYD_SPF=1

# ─────────────────────────────────────────────────────────────
# FORGEJO (Git Hosting)
# ─────────────────────────────────────────────────────────────
FORGEJO_DOMAIN=git.your-domain.com
FORGEJO_SSH_PORT=2222
FORGEJO_SECRET_KEY=CHANGE_ME_FORGEJO_SECRET

# ─────────────────────────────────────────────────────────────
# N8N (Workflow Automation)
# ─────────────────────────────────────────────────────────────
N8N_HOST=n8n.your-domain.com
N8N_PORT=5678
N8N_PROTOCOL=https
N8N_BASIC_AUTH_USER=admin
N8N_BASIC_AUTH_PASSWORD=CHANGE_ME_N8N_PASSWORD
N8N_ENCRYPTION_KEY=CHANGE_ME_N8N_ENCRYPTION_KEY

# ─────────────────────────────────────────────────────────────
# GRAFANA
# ─────────────────────────────────────────────────────────────
GF_SECURITY_ADMIN_USER=admin
GF_SECURITY_ADMIN_PASSWORD=CHANGE_ME_GRAFANA_PASSWORD
GF_SERVER_ROOT_URL=https://grafana.your-domain.com
GF_INSTALL_PLUGINS=grafana-clock-panel,grafana-piechart-panel

# ─────────────────────────────────────────────────────────────
# TRAEFIK
# ─────────────────────────────────────────────────────────────
TRAEFIK_DASHBOARD_USER=admin
# Generate with: htpasswd -nb admin password
TRAEFIK_DASHBOARD_AUTH=admin:$$apr1$$CHANGE_ME
TRAEFIK_LOG_LEVEL=INFO

# ─────────────────────────────────────────────────────────────
# CROWDSEC
# ─────────────────────────────────────────────────────────────
CROWDSEC_BOUNCER_KEY=CHANGE_ME_CROWDSEC_KEY

# ─────────────────────────────────────────────────────────────
# BACKUP
# ─────────────────────────────────────────────────────────────
BACKUP_SCHEDULE=0 3 * * *
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=chainhost-backups
BACKUP_ENCRYPTION_KEY=CHANGE_ME_BACKUP_ENCRYPTION_KEY

# ─────────────────────────────────────────────────────────────
# RATE LIMITING
# ─────────────────────────────────────────────────────────────
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
LOGIN_RATE_LIMIT_MAX=5
API_RATE_LIMIT_MAX=1000
